services:
    test_app:
        image: gitlab.abrbit.com:5555/esaj/panel/test:stable
        container_name: esaj_test_api
        restart: unless-stopped
        env_file:
            - ./docker/.env
        environment:
            DB_HOST: test_mysql
            DB_PORT: 3306
            DB_DATABASE: esaj_test
            DB_USERNAME: esaj_test
            DB_PASSWORD: ahsjdxncqwgdqeiugjWQADRD

            DB_HOST2: test_mysql
            DB_PORT2: 3306
            DB_DATABASE2: esaj_test
            DB_USERNAME2: esaj_test
            DB_PASSWORD2: ahsjdxncqwgdqeiugjWQADRD
            QUEUE_CONNECTION: database

            QUEUE_COUNT: 1

            APP_URL: https://test.testesaj.ir/
            APP_DEBUG: true
            APP_ENV: production
            APP_SECRET_KEY: tlpw@:K#X0$[r,dxPg'Nm~y`3Co8Â£=[;T3N_:6V{t'z*].{1S!
            IRANCELL_BILL: site

            LOG_CHANNEL: file
            # MONGODB_CONNECTION: mongodb
            # MONGODB_HOST: test_mongodb
            # MONGODB_PORT: 27017
            # MONGODB_DATABASE: esaj
            # MONGODB_USERNAME: esaj
            # MONGODB_PASSWORD: esaj_testbox
            # TELESCOPE_DRIVER: database
            TELESCOPE_ENABLE: false
        ports:
            - 4502:80
        volumes:
            - esaj-test-storage:/var/www/html/storage/app/public
        networks:
            - esaj-test

    # testbox_scheduler:
    #     image: gitlab.abrbit.com:5555/esaj/panel/development:stable
    #     container_name: esaj_test_scheduler
    #     restart: always
    #     command: php artisan schedule:work
    #     env_file:
    #         - ./docker/.env
    #     environment:
    #         DB_HOST: test_mysql
    #         DB_PORT: 3306
    #         DB_DATABASE: esaj_test
    #         DB_USERNAME: esaj_test
    #         DB_PASSWORD: ahsjdxncqwgdqeiugjWQADRD
    #         APP_URL: https://dev.testesaj.ir/
    #         APP_DEBUG: true
    #         APP_ENV: development
    #         QUEUE_CONNECTION: database

    #         DB_HOST2: test_mysql
    #         DB_PORT2: 3306
    #         DB_DATABASE2: esaj_test
    #         DB_USERNAME2: esaj_test
    #         DB_PASSWORD2: ahsjdxncqwgdqeiugjWQADRD

    #         TELESCOPE_DRIVER: database
    #         TELESCOPE_ENABLE: false
    #         SENTRY_LARAVEL_DSN: https://eeed05985079ae4200ae4fd9db784683@sentry.abrbit.com/6
    #         SENTRY_TRACES_SAMPLE_RATE: 0.0
    #     volumes:
    #         - esaj-test-storage:/var/www/html/storage/app/public
    #     networks:
    #         - esaj-test

    # testbox_worker:
    #     image: gitlab.abrbit.com:5555/esaj/panel/development:stable
    #     restart: always
    #     command: php artisan queue:work --queue=high,medium,default,group_3,group_1,group_2,group_4,group_5 --sleep=2 --tries=2 --max-time=3600 --timeout=600
    #     env_file:
    #         - ./docker/.env
    #     environment:
    #         DB_HOST: test_mysql
    #         DB_PORT: 3306
    #         DB_DATABASE: esaj_test
    #         DB_USERNAME: esaj_test
    #         DB_PASSWORD: ahsjdxncqwgdqeiugjWQADRD
    #         APP_DEBUG: true
    #         APP_ENV: development
    #         QUEUE_CONNECTION: database

    #         TELESCOPE_DRIVER: database
    #         TELESCOPE_ENABLE: false
    #         APP_URL: https://dev.testesaj.ir/

    #         DB_HOST2: test_mysql
    #         DB_PORT2: 3306
    #         DB_DATABASE2: esaj_test
    #         DB_USERNAME2: esaj_test
    #         DB_PASSWORD2: ahsjdxncqwgdqeiugjWQADRD

    #         LOG_CHANNEL: sentry
    #         MONGODB_CONNECTION: mongodb
    #         MONGODB_HOST: test_mongodb
    #         MONGODB_PORT: 27017
    #         MONGODB_DATABASE: esaj
    #         MONGODB_USERNAME: esaj
    #         MONGODB_PASSWORD: esaj_testbox

    #         REVERB_HOST: testbox_reverb
    #         REVERB_PORT: 9000
    #         REVERB_SCHEME: http
    #         REVERB_APP_ID: my-app-id
    #         REVERB_APP_KEY: my-app-key
    #         REVERB_APP_SECRET: my-app-secret
    #         SENTRY_LARAVEL_DSN: https://eeed05985079ae4200ae4fd9db784683@sentry.abrbit.com/6
    #         SENTRY_TRACES_SAMPLE_RATE: 0.0
    #     volumes:
    #         - esaj-test-storage:/var/www/html/storage/app/public
    #     networks:
    #         - esaj-test

    # testbox_reverb:
    #     image: gitlab.abrbit.com:5555/esaj/panel/development:stable
    #     restart: always
    #     command: php artisan reverb:start --host=0.0.0.0 --port=9000
    #     env_file:
    #         - ./docker/.env
    #     environment:
    #         DB_HOST: test_mysql
    #         DB_PORT: 3306
    #         DB_DATABASE: esaj_test
    #         DB_USERNAME: esaj_test
    #         DB_PASSWORD: ahsjdxncqwgdqeiugjWQADRD
    #         APP_DEBUG: true
    #         APP_ENV: development
    #         QUEUE_CONNECTION: database

    #         TELESCOPE_DRIVER: database
    #         TELESCOPE_ENABLE: false
    #         APP_URL: https://dev.testesaj.ir/

    #         DB_HOST2: test_mysql
    #         DB_PORT2: 3306
    #         DB_DATABASE2: esaj_test
    #         DB_USERNAME2: esaj_test
    #         DB_PASSWORD2: ahsjdxncqwgdqeiugjWQADRD

    #         LOG_CHANNEL: sentry
    #         MONGODB_CONNECTION: mongodb
    #         MONGODB_HOST: test_mongodb
    #         MONGODB_PORT: 27017
    #         MONGODB_DATABASE: esaj
    #         MONGODB_USERNAME: esaj
    #         MONGODB_PASSWORD: esaj_testbox

    #         REVERB_APP_ID: my-app-id
    #         REVERB_APP_KEY: my-app-key
    #         REVERB_APP_SECRET: my-app-secret
    #         REVERB_SHCEME: http
    #         SENTRY_LARAVEL_DSN: https://eeed05985079ae4200ae4fd9db784683@sentry.abrbit.com/6
    #         SENTRY_TRACES_SAMPLE_RATE: 0.0

    #     ports:
    #         - "9000:9000"

    #     volumes:
    #         - esaj-test-storage:/var/www/html/storage/app/public
    #     networks:
    #         - esaj-test


    test_mysql:
        image: registry.abrbit.com/library/mariadb
        restart: always
        container_name: esaj_test_db
        environment:
            MYSQL_DATABASE: esaj_test
            MYSQL_ROOT_PASSWORD: ahsjdxncqwgdqeiugjWQADRD
            MYSQL_PASSWORD: ahsjdxncqwgdqeiugjWQADRD
            MYSQL_USER: esaj_test
            MYSQL_ALLOW_EMPTY_PASSWORD: 'no'
            IRANCELL_BILL: site
        volumes:
            - esaj-test-db-1:/var/lib/mysql
        networks:
            - esaj-test
        healthcheck:
            test: [ "CMD", "mysqladmin", "ping", "-p ahsjdxncqwgdqeiugjWQADRD" , "-h", "test_mysql" ]
            retries: 3
            timeout: 5s
    # test_redis:
    #     container_name: esaj_test_redis
    #     image: registry.abrbit.com/bitnami/redis:latest
    #     environment:
    #         - REDIS_PASSWORD=${REDIS_PASSWORD}
    #         - ALLOW_EMPTY_PASSWORD=no
    #     networks:
    #         - esaj-test
    # test_phpmyadmin:
    #     container_name: esaj_test_phpmyadmin
    #     image: registry.abrbit.com/library/phpmyadmin
    #     restart: always
    #     ports:
    #         - 3121:80
    #     environment:
    #         PMA_ARBITRARY: 1
    #         PMA_HOST: test_mysql
    #         PMA_ABSOLUTE_URI: https://pma-dev.testesaj.ir/
    #     networks:
    #         - esaj-test
    #     depends_on:
    #         - test_mysql
    # test_mongo:
    #     image: docker.arvancloud.ir/mongo:latest
    #     container_name: test_mongodb
    #     restart: always
    #     environment:
    #         MONGO_INITDB_ROOT_USERNAME: esaj
    #         MONGO_INITDB_ROOT_PASSWORD: esaj_testbox
    #         MONGO_INITDB_DATABASE: esaj
    #     volumes:
    #         - test-mongodb-data:/data/db
    #     # ports:
    #     #     - "27017:27017"
    #     networks:
    #         - esaj-test
    # test_mongo_express:
    #     image: docker.arvancloud.ir/mongo-express:latest
    #     container_name: test_mongo_express
    #     restart: always
    #     ports:
    #         - "8081:8081"
    #     environment:
    #         ME_CONFIG_MONGODB_SERVER: test_mongodb
    #         ME_CONFIG_MONGODB_ADMINUSERNAME: esaj
    #         ME_CONFIG_MONGODB_ADMINPASSWORD: esaj_testbox
    #         ME_CONFIG_BASICAUTH_USERNAME: admin
    #         ME_CONFIG_BASICAUTH_PASSWORD: iik8AebuXee8kah5Ohphush3
    #     networks:
    #         - esaj-test
networks:
    esaj-test:
        driver: bridge

volumes:
    esaj-test-storage:
    esaj-test-db-1:
    esaj-db-old:
    test-mongodb-data:


